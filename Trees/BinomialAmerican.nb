(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     24865,        655]
NotebookOptionsPosition[     23804,        629]
NotebookOutlinePosition[     24141,        644]
CellTagsIndexPosition[     24098,        641]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "program", " ", "uses", " ", "binomial", " ", "trees", " ", 
     "to", " ", "price", " ", "American", "  ", "options"}], 
    "\[IndentingNewLine]", "-", 
    RowBox[{
    "First", " ", "we", " ", "analyze", " ", "put", " ", "options", " ", 
     "and", " ", "see", " ", "advantage", " ", "of", " ", "early", " ", 
     RowBox[{"exercise", ".", "\[IndentingNewLine]", 
      RowBox[{"-", "For"}]}], " ", "call", " ", "options", " ", "no", " ", 
     RowBox[{"advantage", ".", "\[IndentingNewLine]", 
      RowBox[{"-", "For"}]}], " ", "info", " ", "related", " ", "to", " ", 
     "the", " ", "functions", " ", "involved", " ", "in", " ", "the", " ", 
     "code", " ", "see", " ", "the", " ", "program", " ", "for", " ", 
     "European", " ", 
     RowBox[{"options", "."}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Calibration", " ", "of", " ", "parameters"}], 
      "\[IndentingNewLine]", "-", 
      RowBox[{"Chosing", " ", "d"}]}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"1", "/", "u"}], " ", "gives", " ", "a", " ", "symmetric", " ",
        "random", " ", "walk", " ", 
       RowBox[{
        RowBox[{"(", "SRW", ")"}], ".", " ", "This"}], " ", "reduces", " ", 
       "the", " ", "number", " ", "of", " ", "entries", " ", "of", " ", "the",
        " ", "matrix", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
         "each", " ", "row", " ", "only", " ", "has", " ", "one", " ", "more",
           " ", "entry", " ", "than", " ", "the", " ", "previous", " ", 
          "one"}], ")"}], ".", "\[IndentingNewLine]", 
        RowBox[{"-", "Instead"}]}], " ", "of", " ", "$1"}], "+", "r"}]}], ",",
     " ", 
    RowBox[{"1", "+", "a"}], ",", " ", 
    RowBox[{"1", "+", 
     RowBox[{"b$", " ", "we", " ", "write", " ", "$exp", 
      RowBox[{"(", "rdelta", ")"}]}]}], ",", " ", "u", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"1", "/", "u$"}], " ", "with", " ", "$u"}], "=", 
     RowBox[{"exp", 
      RowBox[{"(", 
       RowBox[{"sigma", "*", 
        RowBox[{"sqrt", "[", "delta", "]"}]}], ")"}], 
      RowBox[{"$", "."}]}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"T", "=", 
     RowBox[{"5", "/", "12"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"delta", "[", "n_", "]"}], ":=", 
     RowBox[{"T", "/", "n"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"u", "[", 
      RowBox[{"n_", ",", "sigma_"}], "]"}], ":=", 
     RowBox[{"Exp", "[", 
      RowBox[{"sigma", "*", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"delta", "[", "n", "]"}], "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"d", "[", 
      RowBox[{"n_", ",", "sigma_"}], "]"}], ":=", 
     RowBox[{"1", "/", 
      RowBox[{"u", "[", 
       RowBox[{"n", ",", "sigma"}], "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"n_", ",", "sigma_", ",", "r_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{"r", "*", 
          RowBox[{"delta", "[", "n", "]"}]}], "]"}], "-", 
        RowBox[{"d", "[", 
         RowBox[{"n", ",", "sigma"}], "]"}]}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"n", ",", "sigma"}], "]"}], "-", 
        RowBox[{"d", "[", 
         RowBox[{"n", ",", "sigma"}], "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{"Build", " ", "the", " ", "stock", " ", "price", " ", "tree"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stockTree", "[", 
      RowBox[{"n_", ",", "sigma_", ",", "S0_"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"S0", "*", 
        RowBox[{
         RowBox[{"u", "[", 
          RowBox[{"n", ",", "sigma"}], "]"}], "^", 
         RowBox[{"(", 
          RowBox[{"j", "-", "1"}], ")"}]}], "*", 
        RowBox[{
         RowBox[{"d", "[", 
          RowBox[{"n", ",", "sigma"}], "]"}], "^", 
         RowBox[{"(", 
          RowBox[{"i", "-", "j"}], ")"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "n"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "i"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"stockTree", "[", 
      RowBox[{"3", ",", "0.1", ",", "1"}], "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Build", " ", "Snell", " ", "envelope", " ", "of", " ", "the", " ", 
     "payoff", " ", "function", " ", "for", " ", "American", " ", "put", " ", 
     
     RowBox[{"recursively", ":", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"-", "The"}], " ", "exprected", " ", "price", " ", "for", " ", 
       "the", " ", "Snell", " ", "envelope", " ", "yields", " ", "the", " ", 
       "price", " ", "of", " ", "the", " ", "American", " ", "put", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"see", " ", "Elliott"}], "-", 
          RowBox[{"Kopp", " ", "or", " ", "notes"}]}], ")"}], "."}]}]}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AmericanPut", "[", 
      RowBox[{"n_", ",", "sigma_", ",", "S0_", ",", "K_", ",", "r_"}], "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"stockT", "=", 
          RowBox[{"stockTree", "[", 
           RowBox[{"n", ",", "sigma", ",", "S0"}], "]"}]}], ",", "optionT"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Initialize", " ", "option", " ", "tree", " ", "at", " ", 
         "maturity"}], "*)"}], 
       RowBox[{
        RowBox[{"optionT", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{"K", "-", 
              RowBox[{"stockT", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "i"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Backward", " ", "induction"}], ",", " ", 
          RowBox[{
          "take", " ", "Max", " ", "between", " ", "actual", " ", "value", 
           " ", "and", " ", "expected", " ", "payoff"}]}], "*)"}], 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"optionT", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"Max", "[", 
            RowBox[{
             RowBox[{"K", "-", 
              RowBox[{"stockT", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "r"}], "*", 
                RowBox[{"delta", "[", "n", "]"}]}], "]"}], "*", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"n", ",", "sigma", ",", "r"}], "]"}], "*", 
                 RowBox[{"optionT", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"i", "+", "1"}], ",", 
                    RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"p", "[", 
                    RowBox[{"n", ",", "sigma", ",", "r"}], "]"}]}], ")"}], 
                 "*", 
                 RowBox[{"optionT", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}]}]}], 
               ")"}]}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"n", "-", "1"}], ",", "1", ",", 
            RowBox[{"-", "1"}]}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Backwards", " ", "in", " ", "time"}], "*)"}], 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "i"}], "}"}]}], "        ", 
         RowBox[{"(*", 
          RowBox[{
          "For", " ", "each", " ", "node", " ", "at", " ", "this", " ", 
           "time", " ", "step"}], "*)"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Return", " ", "option", " ", "price", " ", "at", " ", "t"}], "=", 
          "0"}], "*)"}], 
        RowBox[{"optionT", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", " ", 
   RowBox[{"AmericanPut", "[", 
    RowBox[{"100", ",", "0.8", ",", "50", ",", "50", ",", "0.05"}], "]"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.953229117684875*^9, 3.953229125081221*^9}, {
   3.953229499082758*^9, 3.953229608734542*^9}, {3.953229693832034*^9, 
   3.953229860928278*^9}, {3.953229929810079*^9, 3.9532299407338133`*^9}, {
   3.953230116620859*^9, 3.953230119904112*^9}, {3.95323016743924*^9, 
   3.953230197396402*^9}, 3.953230260709046*^9, {3.953230326530304*^9, 
   3.953230327383477*^9}, 3.953230396928537*^9},
 CellLabel->"In[28]:=",ExpressionUUID->"e43df53b-081f-473c-ab5f-488b0944f21c"],

Cell[BoxData["9.649657020252995`"], "Output",
 CellChangeTimes->{3.953229134545411*^9, 3.9532299011434603`*^9, 
  3.953229980440505*^9, 3.9532301614197817`*^9, 3.953230261930626*^9, 
  3.953230296987986*^9, 3.953230328779879*^9, 3.953230398525764*^9},
 CellLabel->"Out[36]=",ExpressionUUID->"57fe8d57-fb75-47bf-9b0d-8cf230a6fcc4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "We", " ", "now", " ", "compare", " ", "the", " ", "price", " ", "above", 
    " ", "with", " ", "the", " ", "price", " ", "of", " ", "the", " ", 
    "associated", " ", "European", " ", "put", " ", 
    RowBox[{"option", "."}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"EuropeanPut", "[", 
      RowBox[{"n_", ",", "sigma_", ",", "S0_", ",", "K_", ",", "r_"}], "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"stockT", "=", 
          RowBox[{"stockTree", "[", 
           RowBox[{"n", ",", "sigma", ",", "S0"}], "]"}]}], ",", "optionT"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Initialize", " ", "option", " ", "tree", " ", "at", " ", 
         "maturity"}], "*)"}], 
       RowBox[{
        RowBox[{"optionT", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{"K", "-", 
              RowBox[{"stockT", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "i"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Backward", " ", "induction"}], "*)"}], 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"optionT", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", " ", 
           RowBox[{
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "r"}], "*", 
              RowBox[{"delta", "[", "n", "]"}]}], "]"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"n", ",", "sigma", ",", "r"}], "]"}], "*", 
               RowBox[{"optionT", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", 
                  RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"p", "[", 
                  RowBox[{"n", ",", "sigma", ",", "r"}], "]"}]}], ")"}], "*", 
               
               RowBox[{"optionT", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}]}]}], 
             ")"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"n", "-", "1"}], ",", "1", ",", 
            RowBox[{"-", "1"}]}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Backwards", " ", "in", " ", "time"}], "*)"}], 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "i"}], "}"}]}], "        ", 
         RowBox[{"(*", 
          RowBox[{
          "For", " ", "each", " ", "node", " ", "at", " ", "this", " ", 
           "time", " ", "step"}], "*)"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Return", " ", "option", " ", "price", " ", "at", " ", "t"}], "=", 
          "0"}], "*)"}], 
        RowBox[{"optionT", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "See", " ", "that", " ", "the", " ", "price", " ", "of", " ", "European", 
     " ", "put", " ", "is", " ", "smaller", " ", "than", " ", "that", " ", 
     "of", " ", "American"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"AmericanPut", "[", 
    RowBox[{"100", ",", "0.8", ",", "50", ",", "50", ",", "0.05"}], "]"}], 
   "\[IndentingNewLine]", " ", 
   RowBox[{"EuropeanPut", "[", 
    RowBox[{"100", ",", "0.8", ",", "50", ",", "50", ",", "0.05"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9532302173157997`*^9, 3.953230293408206*^9}, {
  3.9532303355142593`*^9, 3.953230372794464*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"c2a5a7cf-7d8f-43b5-97ea-3dc04b205fe1"],

Cell[BoxData["9.649657020252995`"], "Output",
 CellChangeTimes->{
  3.953230299299041*^9, {3.953230332209744*^9, 3.953230336970559*^9}, 
   3.953230374829948*^9},
 CellLabel->"Out[26]=",ExpressionUUID->"837e0f7c-e458-465f-9474-8d94abdd72f9"],

Cell[BoxData["9.555680697598453`"], "Output",
 CellChangeTimes->{
  3.953230299299041*^9, {3.953230332209744*^9, 3.953230336970559*^9}, 
   3.953230375178392*^9},
 CellLabel->"Out[27]=",ExpressionUUID->"40564df4-3966-4bd2-bf5f-4d798c8758eb"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Finally", " ", "we", " ", "deal", " ", "with", " ", "American", " ", 
    "call", " ", "options", " ", "and", " ", "see", " ", "that", " ", "no", 
    " ", "advantage", " ", "in", " ", "early", " ", "exercise"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"AmericanCall", "[", 
      RowBox[{"n_", ",", "sigma_", ",", "S0_", ",", "K_", ",", "r_"}], "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"stockT", "=", 
          RowBox[{"stockTree", "[", 
           RowBox[{"n", ",", "sigma", ",", "S0"}], "]"}]}], ",", "optionT"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Initialize", " ", "option", " ", "tree", " ", "at", " ", 
         "maturity"}], "*)"}], 
       RowBox[{
        RowBox[{"optionT", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"stockT", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", "K"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "i"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Backward", " ", "induction"}], ",", " ", 
          RowBox[{
          "take", " ", "Max", " ", "between", " ", "actual", " ", "value", 
           " ", "and", " ", "expected", " ", "payoff"}]}], "*)"}], 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"optionT", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"Max", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"stockT", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", "K"}], ",", " ", 
             RowBox[{
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "r"}], "*", 
                RowBox[{"delta", "[", "n", "]"}]}], "]"}], "*", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"n", ",", "sigma", ",", "r"}], "]"}], "*", 
                 RowBox[{"optionT", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"i", "+", "1"}], ",", 
                    RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"p", "[", 
                    RowBox[{"n", ",", "sigma", ",", "r"}], "]"}]}], ")"}], 
                 "*", 
                 RowBox[{"optionT", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}]}]}], 
               ")"}]}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"n", "-", "1"}], ",", "1", ",", 
            RowBox[{"-", "1"}]}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Backwards", " ", "in", " ", "time"}], "*)"}], 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "i"}], "}"}]}], "        ", 
         RowBox[{"(*", 
          RowBox[{
          "For", " ", "each", " ", "node", " ", "at", " ", "this", " ", 
           "time", " ", "step"}], "*)"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Return", " ", "option", " ", "price", " ", "at", " ", "t"}], "=", 
          "0"}], "*)"}], 
        RowBox[{"optionT", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"EuropeanCall", "[", 
      RowBox[{"n_", ",", "sigma_", ",", "S0_", ",", "K_", ",", "r_"}], "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"stockT", "=", 
          RowBox[{"stockTree", "[", 
           RowBox[{"n", ",", "sigma", ",", "S0"}], "]"}]}], ",", "optionT"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Initialize", " ", "option", " ", "tree", " ", "at", " ", 
         "maturity"}], "*)"}], 
       RowBox[{
        RowBox[{"optionT", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"stockT", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", "K"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "i"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Backward", " ", "induction"}], ",", " ", 
          RowBox[{
          "take", " ", "Max", " ", "between", " ", "actual", " ", "value", 
           " ", "and", " ", "expected", " ", "payoff"}]}], "*)"}], 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"optionT", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", "r"}], "*", 
              RowBox[{"delta", "[", "n", "]"}]}], "]"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"n", ",", "sigma", ",", "r"}], "]"}], "*", 
               RowBox[{"optionT", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", 
                  RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"p", "[", 
                  RowBox[{"n", ",", "sigma", ",", "r"}], "]"}]}], ")"}], "*", 
               
               RowBox[{"optionT", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}]}]}], 
             ")"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"n", "-", "1"}], ",", "1", ",", 
            RowBox[{"-", "1"}]}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{"Backwards", " ", "in", " ", "time"}], "*)"}], 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "i"}], "}"}]}], "        ", 
         RowBox[{"(*", 
          RowBox[{
          "For", " ", "each", " ", "node", " ", "at", " ", "this", " ", 
           "time", " ", "step"}], "*)"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Return", " ", "option", " ", "price", " ", "at", " ", "t"}], "=", 
          "0"}], "*)"}], 
        RowBox[{"optionT", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"AmericanCall", "[", 
    RowBox[{"100", ",", "0.8", ",", "50", ",", "50", ",", "0.05"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"EuropeanCall", "[", 
    RowBox[{"100", ",", "0.8", ",", "50", ",", "50", ",", "0.05"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.953230414884556*^9, 3.953230441996017*^9}, {
  3.953230510336553*^9, 
  3.953230625219384*^9}},ExpressionUUID->"55e88ebd-c0df-4ee0-9ee8-\
adf2b5129367"],

Cell[BoxData["10.57636867054249`"], "Output",
 CellChangeTimes->{3.953230589488961*^9, 3.953230620700549*^9},
 CellLabel->"Out[43]=",ExpressionUUID->"c7a695ec-652a-496e-ad3b-be2edb566427"],

Cell[BoxData["10.57636867054249`"], "Output",
 CellChangeTimes->{3.953230589488961*^9, 3.9532306210434847`*^9},
 CellLabel->"Out[44]=",ExpressionUUID->"c9e361ba-6258-4b3d-a3d4-35eab5516c28"]
}, Open  ]]
},
WindowSize->{808, 685},
WindowMargins->{{20, Automatic}, {Automatic, 44}},
FrontEndVersion->"12.0 for Mac OS X x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 9733, 250, 934, "Input",ExpressionUUID->"e43df53b-081f-473c-ab5f-488b0944f21c"],
Cell[10316, 274, 330, 4, 34, "Output",ExpressionUUID->"57fe8d57-fb75-47bf-9b0d-8cf230a6fcc4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10683, 283, 4281, 110, 346, "Input",ExpressionUUID->"c2a5a7cf-7d8f-43b5-97ea-3dc04b205fe1"],
Cell[14967, 395, 241, 4, 34, "Output",ExpressionUUID->"837e0f7c-e458-465f-9474-8d94abdd72f9"],
Cell[15211, 401, 241, 4, 34, "Output",ExpressionUUID->"40564df4-3966-4bd2-bf5f-4d798c8758eb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15489, 410, 7915, 208, 640, "Input",ExpressionUUID->"55e88ebd-c0df-4ee0-9ee8-adf2b5129367"],
Cell[23407, 620, 188, 2, 34, "Output",ExpressionUUID->"c7a695ec-652a-496e-ad3b-be2edb566427"],
Cell[23598, 624, 190, 2, 34, "Output",ExpressionUUID->"c9e361ba-6258-4b3d-a3d4-35eab5516c28"]
}, Open  ]]
}
]
*)

